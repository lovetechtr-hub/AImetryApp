# Локализация (i18n) для AImetryApp

## Поддерживаемые языки

Приложение поддерживает **12 языков**:

| Код | Язык | Название |
|-----|------|----------|
| `en` | English | Английский |
| `es` | Español | Испанский |
| `fr` | Français | Французский |
| `de` | Deutsch | Немецкий |
| `ru` | Русский | Русский |
| `uk` | Українська | Украинский |
| `tr` | Türkçe | Турецкий |
| `ja` | 日本語 | Японский |
| `zh-CN` | 简体中文 | Китайский (упрощенный) |
| `pt-BR` | Português (BR) | Португальский (Бразилия) |
| `it` | Italiano | Итальянский |
| `ko` | 한국어 | Корейский |

## Структура локализации

### Файлы

- `i18n/Locale.kt` - enum для языков
- `i18n/Strings.kt` - константы ключей строк
- `i18n/Translations.kt` - все переводы для всех языков
- `i18n/LocalizationManager.kt` - менеджер для управления локализацией
- `ui/i18n/I18nProvider.kt` - Compose провайдер для доступа к локализации

### Хранение выбранного языка

Язык сохраняется в `SessionStorage` с ключом `aimetry_locale`.

**Android**: SharedPreferences  
**iOS**: NSUserDefaults

### Определение языка по умолчанию

При первом запуске приложения язык определяется автоматически:
- **Android**: через `Locale.getDefault()`
- **iOS**: через `NSLocale.preferredLanguages`

## Использование

### В Compose UI

```kotlin
@Composable
fun MyScreen() {
    val i18n = useI18n()
    
    Text(i18n.t(Strings.WELCOME))
    Text(i18n.t(Strings.ARTISTS_COUNT, artistCount))
    
    // Изменение языка
    Button(onClick = { i18n.setLocale(Locale.RUSSIAN) }) {
        Text("Русский")
    }
}
```

### Получение строки

```kotlin
// Простая строка
val text = i18n.t(Strings.WELCOME)

// С аргументами
val text = i18n.t(Strings.ARTISTS_COUNT, count)
```

### Изменение языка

```kotlin
i18n.setLocale(Locale.RUSSIAN)
```

### Компонент выбора языка

Используйте готовый компонент `LanguageSelector`:

```kotlin
LanguageSelector()
```

## Добавление новых строк

1. Добавьте константу в `Strings.kt`:
```kotlin
const val NEW_STRING = "new_string"
```

2. Добавьте переводы во все языки в `Translations.kt`:
```kotlin
val en = mapOf(
    // ...
    Strings.NEW_STRING to "New String"
)

val ru = mapOf(
    // ...
    Strings.NEW_STRING to "Новая строка"
)
// ... и для всех остальных языков
```

3. Используйте в UI:
```kotlin
Text(i18n.t(Strings.NEW_STRING))
```

## Интеграция с DI (Koin)

LocalizationManager предоставляется через Koin:

```kotlin
val i18nModule = module {
    single<LocalizationManager> {
        LocalizationManager(get<SessionStorage>())
    }
}
```

Используйте в ViewModel или другом классе:

```kotlin
class MyViewModel(
    private val localizationManager: LocalizationManager
) {
    fun getText(key: String): String {
        return localizationManager.getString(key)
    }
}
```

## Лучшие практики

1. **Всегда используйте константы из `Strings`** вместо хардкода строк
2. **Добавляйте переводы для всех языков** при добавлении новых строк
3. **Используйте аргументы** для динамических значений вместо конкатенации строк
4. **Тестируйте на разных языках** особенно для RTL языков (если добавятся)

## Примеры

### Простая строка
```kotlin
Text(i18n.t(Strings.WELCOME))
```

### С аргументами
```kotlin
Text(i18n.t(Strings.ARTISTS_COUNT, count))
```

### Выбор языка
```kotlin
@Composable
fun SettingsScreen() {
    val i18n = useI18n()
    
    Column {
        Text("Select Language")
        Locale.values().forEach { locale ->
            Button(onClick = { i18n.setLocale(locale) }) {
                Text(locale.displayName)
            }
        }
    }
}
```

## Troubleshooting

### Язык не меняется

Убедитесь, что:
1. Вы вызываете `setLocale()` на правильном экземпляре `LocalizationManager`
2. Используете один и тот же экземпляр через DI/CompositionLocal
3. UI перекомпозируется после изменения языка

### Отсутствует перевод

Если перевод отсутствует, будет возвращен ключ. Добавьте перевод в `Translations.kt`.

### Неправильный язык по умолчанию

Проверьте platform-specific реализации `getPlatformDefaultLocale()` для Android и iOS.

